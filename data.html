<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta -->
    <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Responsive -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">

    <title>DATA</title>

    <!--CSS -->
    <link rel="icon" href="images/favicon.ico" type="image/png" sizes="16x16">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700" rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@3.0.10/dist/esri-leaflet.js"></script>
    <!-- Load Esri Leaflet Vector from CDN -->
    <script src="https://unpkg.com/esri-leaflet-vector@4.1.0/dist/esri-leaflet-vector.js" crossorigin=""></script>

    <!-- Add custom CSS here -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>

    <style>
        .chart-container {
            height: 245px;
            width: 245px;
        }

        #info-pane {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 500;
            padding: 1em;
            background: white;
        }
    </style>

    <!-- <style>
        html,
        body,
        #map {
            padding: 0;
            margin: 20px;
            height: 100%;
            width: 100%;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 14px;
            color: #323232;
        }
    </style> -->

    <!---
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    -->
</head>

<body>

    <!-- TOP BAR -->
    <div id="main-nav" class="navbar navbar-default bs-docs-nav" role="banner">
        <div class="container">
            <div class="navbar-header responsive-logo">
                <button class="navbar-toggle collapsed" type="button" data-toggle="collapse"
                    data-target="#bs-navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="navbar-brand">
                    <a href="index.html"><img src="images/metamodelr_logo.png" alt="logo" class="img-responsive"></a>

                </div>
            </div>
            <nav class="navbar-collapse collapse navbar-right" role="navigation" id="bs-navbar-collapse">
                <ul class="nav navbar-nav navbar-right responsive-nav main-nav-list">
                    <li><a href="index.html">HOME</a></li>
                    <li><a href="about.html">ABOUT</a></li>
                    <li><a href="consulting.html">CONSULTING</a></li>
                    <li><a href="solutions.html">SOLUTIONS</a></li>
                    <li class="active"><a href="data.html">DATA</a></li>
                    <li><a href="contact.html">CONTACT</a></li>
                    <li><a href="login.html">LOGIN</a></li>
                </ul>
            </nav>
        </div>
    </div>
    <!-- TOP BAR END-->

    <!--START: BANNER-->
    <section class="banner-section-data">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-sm-6 col-xs-12">
                    <h1 class="page-title">Data</h1>
                </div>
                <div class="col-md-6 col-sm-6 hidden-xs login-breadcrumb">
                    <ol class="breadcrumb">
                        <!--
                    <li><a href="index.php">Home</a></li>
                    <li><a href="#">Login</a></li>
                    -->
                    </ol>
                </div>
            </div>
        </div>
    </section>
    <!--END: BANNER-->


    <div id="map">
        <div id="info-pane" class="leaflet-bar chart-container">
            <canvas id="chartCanvas"></canvas>
        </div>
    </div>


    <!--START: FOOTER-->
    <section class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-sm-3 col-xs-12">
                    <div class="footer-logo">
                        <img src="images/metamodelr_logo2.png" class="img-responsive" alt="">
                    </div>
                </div>
                <div class="col-md-9 col-sm-9 col-xs-12">
                    <p>MetamodelR is a division of Credience Corporation (ABN: 89 128 863 945, ACN: 128 863 945) is an
                        Australian based
                        data science and data engineering software development company.</p>
                    <br>
                    <p>MetamodelR treats the data privacy and data security of its clients and associated entities very
                        seriously, by adhering to ISO 27701 and ISO 27001 standards, respectively. If you believe that
                        your data is compromised, please contact us, either to report a breach or incident, or for us to
                        help you remedy the situation.</p>
                    <br>

                    <div class="span">
                        <p class="copyright">Â© 2018 MetamodelR Corporation | <a href="terms.html">Terms &amp;
                                Conditions</a> | <a href="privacy.html">Privacy</a></p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <a id="scrollUp" title="Scroll to top"><i class="fa fa-chevron-up"></i></a>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script src="js/slick.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/custom.js"></script>
    <script>
        const apiKey = "AAPK89f89b7de4ff402785b3f66b6b8ec076hLAJqg7TzelGB1f9RQB0aRD1cetWxbHtFKF-R0aNjzsShRpnhrpY-kkXkmHoy-9y";

        const map = L.map("map").setView([45.526, -122.667], 13);

        L.esri.Vector.vectorBasemapLayer("arcgis/community", {
            apikey: apiKey
        }).addTo(map);

        //Features from this layer will appear in the Chart.js scatterplot
        const treesFeatureLayer = L.esri.featureLayer({
            url: "https://www.portlandmaps.com/arcgis/rest/services/Public/Parks_Misc/MapServer/21/"
        });

        treesFeatureLayer.addTo(map);

        const initialChartData = { //Define a chart
            datasets: [
                {
                    label: "Portland Heritage Trees",
                    data: [] //Data will be update dynamically below
                }
            ]
        };

        const chartOptions = {
            scales: {
                x: {
                    title: {
                        display: true,
                        text: "tree diameter"
                    },
                    beginAtZero: true,
                    max: 250,
                    ticks: {
                        stepSize: 50
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: "tree height"
                    },
                    beginAtZero: true,
                    max: 250,
                    ticks: {
                        stepSize: 50
                    }
                }
            },
            maintainAspectRatio: false, // Turn off animations during chart data updates
            animation: false,
            onHover: handleChartHover
        };

        const chart = new Chart("chartCanvas", {
            type: "scatter",
            data: initialChartData,
            options: chartOptions
        });

        map.on("zoom move", updateChart); //Show in the chart only the features in the map's current extent
        treesFeatureLayer.on("load", updateChart);

        function updateChart() {
            // reformat the features' attributes of interest into
            // the data array format required by the Chart.js scatterplot
            const scatterPlotDataArray = [];

            treesFeatureLayer.eachActiveFeature(function (e) {
                scatterPlotDataArray.push({
                    x: e.feature.properties.DIAMETER,
                    y: e.feature.properties.HEIGHT,
                    featureId: e.feature.id
                });
            });

            // assign the new scatterPlotDataArray to the chart's data property
            chart.data.datasets[0].data = scatterPlotDataArray;

            chart.update();
        }


        function handleChartHover(event, elements, chart) {
            if (!elements.length) {
                treesFeatureLayer.eachFeature(function (e) {
                    e.setOpacity(1);
                    e.setZIndexOffset(0);
                });

                return;
            }

            const hoverFeatureIds = elements.map(function (datum) {
                return chart.data.datasets[datum.datasetIndex].data[datum.index].featureId;
            });

            treesFeatureLayer.eachFeature(function (e, idx) {
                if (hoverFeatureIds.indexOf(e.feature.id) > -1) {
                    e.setOpacity(1);
                    e.setZIndexOffset(10000);
                } else {
                    e.setOpacity(0.1);
                }
            });
        }
    </script>
</body>

</html>